<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Raise Complaint — Civic Connect</title>
<style>
:root{
  --bg:#08080a; --panel:#0f1012; --muted:#a9a6b0;
  --accent:#8f45d9; --accent-2:#c16cf0; --glow: rgba(193,108,240,0.12);
  --accent-strong: #7a2ff2; --success:#4ade80; --danger:#ff6b6b;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; font-family:Inter,system-ui,Segoe UI,Roboto,Arial;
  background: linear-gradient(180deg,#070707,#0d0d0f); color:#ece9f6;
  padding:28px; -webkit-font-smoothing:antialiased;
}
.container{
  max-width:1000px; margin:0 auto;
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  border-radius:12px; padding:22px; border:10px solid rgba(143,69,217,0.08);
  box-shadow: 0 30px 80px rgba(0,0,0,0.6), 0 0 40px var(--glow);
}
.header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:18px}
.brand{display:flex;gap:12px;align-items:center}
.logo{width:50px;height:50px;border-radius:10px;background:linear-gradient(135deg,var(--accent),var(--accent-2));display:flex;align-items:center;justify-content:center;font-weight:800}
.title{font-size:18px;color:var(--accent-2);font-weight:700}
.subtitle{font-size:13px;color:var(--muted)}

.form-grid{display:grid;grid-template-columns: 1fr 420px; gap:22px; align-items:start}
@media (max-width:900px){ .form-grid{grid-template-columns:1fr} }

.panel{background:rgba(255,255,255,0.01);padding:18px;border-radius:10px;border:1px solid rgba(255,255,255,0.02)}
h2{margin:0 0 10px 0; color:var(--accent-2); text-decoration:underline 3px var(--accent-strong); text-transform:uppercase; font-size:18px}
.label{font-size:13px;color:var(--muted);margin-bottom:6px}
.input, textarea, select{
  width:100%; padding:10px 12px; border-radius:8px; border:none; background:#0e0e10; color:#eee;
  outline:none; font-size:14px; box-shadow: inset 0 -8px 16px rgba(0,0,0,0.6);
}
textarea{min-height:120px; resize:vertical}
.row{display:flex;gap:10px;align-items:center}
.small{font-size:12px;color:var(--muted)}

.file-list{display:flex;flex-wrap:wrap;gap:10px;margin-top:10px}
.thumb{position:relative;width:110px;height:80px;border-radius:8px;overflow:hidden;border:3px solid rgba(255,255,255,0.02);background:#0b0b0b;display:flex;align-items:center;justify-content:center}
.thumb img{width:100%;height:100%;object-fit:cover}
.thumb button{position:absolute;top:6px;right:6px;background:rgba(0,0,0,0.6);border:none;color:#fff;padding:6px;border-radius:6px;cursor:pointer}

.actions{display:flex;gap:12px;margin-top:12px;align-items:center}
.btn{padding:10px 16px;border-radius:10px;border:none;cursor:pointer;font-weight:700}
.btn-primary{background:linear-gradient(90deg,var(--accent),var(--accent-2));color:white;box-shadow:0 8px 30px rgba(193,108,240,0.12)}
.btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted)}
.toggle{display:flex;gap:8px;align-items:center}

.suggest{margin-top:8px;padding:10px;border-radius:8px;background:linear-gradient(90deg, rgba(143,69,217,0.03), transparent); color:var(--muted); font-size:13px}

.right-column .panel{display:flex;flex-direction:column;gap:12px}
.meta{font-size:13px;color:var(--muted)}
.footer{margin-top:16px;text-align:center;color:var(--muted);font-size:13px}

/* modal */
.modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,0.6);display:none;align-items:center;justify-content:center;z-index:999}
.modal{background:#0b0b0d;padding:20px;border-radius:12px;max-width:420px;width:92%;border:6px solid rgba(143,69,217,0.06);box-shadow:0 20px 60px rgba(0,0,0,0.6)}
.modal h3{margin:0 0 8px 0;color:var(--accent-2)}
.modal p{margin:0 0 12px 0;color:var(--muted)}
.modal .ok{display:flex;justify-content:space-between;align-items:center;gap:10px}
.link{color:var(--accent-strong);text-decoration:underline;font-weight:700}
.error{color:var(--danger);font-size:13px;margin-top:6px}

/* tiny helper */
.flex-between{display:flex;justify-content:space-between;align-items:center}
.info-pill{background:rgba(255,255,255,0.02);padding:6px 10px;border-radius:999px;font-weight:700;color:var(--muted);font-size:13px;border:3px solid rgba(255,255,255,0.02)}
</style>
</head>
<body>
<div class="container" role="main">
  <div class="header">
    <div class="brand">
      <div class="logo">CC</div>
      <div>
        <div class="title">Civic Connect</div>
        <div class="subtitle">Raise your complaint — SIH 2025</div>
      </div>
    </div>

    <div class="right">
      <div class="meta small">Signed in as <strong id="demoName">Anonymous</strong></div>
      <div style="height:6px"></div>
      <div class="info-pill" id="anonToggleLabel">Posting as: <span id="anonState">Anonymous</span></div>
    </div>
  </div>

  <div class="form-grid">
    <!-- left: form -->
    <div class="panel">
      <h2>RAISE YOUR COMPLAINT</h2>

      <div>
        <div class="label">What issue are you facing?</div>
        <input id="title" class="input" placeholder="e.g. Potholed road near ABC colony" />
      </div>

      <div style="margin-top:12px">
        <div class="label">Description of issue</div>
        <textarea id="description" placeholder="Write a clear description: when started, how severe, who affected..."></textarea>
      </div>

      <div style="margin-top:12px">
        <div class="label">Select issue related images (multiple)</div>
        <input id="imagesInput" type="file" accept="image/*" multiple capture="environment" class="input" />
        <div class="file-list" id="previewList" aria-live="polite"></div>
      </div>

      <div style="margin-top:12px">
        <div class="label">Location</div>
        <div class="row">
          <button class="btn btn-ghost" id="detectBtn">Auto-detect location</button>
          <div class="small" id="locStatus">No location detected</div>
        </div>
        <div style="margin-top:8px">
          <input id="locationInput" class="input" placeholder="Manual override: enter location/address" />
        </div>
      </div>

      <div style="margin-top:12px">
        <div class="label">Concerned authority</div>
        <select id="authoritySelect" class="input">
          <option value="">-- Select authority --</option>
          <option>Municipality</option>
          <option>Roads / PWD</option>
          <option>Water / Sewage</option>
          <option>Electricity</option>
          <option>Sanitation</option>
          <option>Traffic Police</option>
          <option>Environment / Forests</option>
          <option>Other</option>
        </select>

        <div class="suggest" id="aiSuggestArea">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div style="font-weight:700">AI Suggested Authority</div>
            <div style="font-size:12px;color:var(--muted)">based on keywords</div>
          </div>
          <div style="margin-top:8px;display:flex;gap:8px;align-items:center">
            <input id="aiSuggested" class="input" placeholder="AI will suggest here..." readonly />
            <button class="btn btn-ghost" id="applySuggestion" title="Apply suggestion to dropdown">Apply</button>
          </div>
        </div>
      </div>

      <div style="margin-top:12px" class="flex-between">
        <div>
          <label class="small">Your name (auto-filled)</label><br>
          <input id="userName" class="input" placeholder="Name (click toggle to make non-anonymous)" />
        </div>
        <div style="width:12px"></div>
        <div style="min-width:160px">
          <label class="small">Contact email (auto)</label><br>
          <input id="userEmail" class="input" placeholder="email@example.com" />
        </div>
      </div>

      <div style="margin-top:12px" class="row">
        <label class="small toggle"><input id="anonToggle" type="checkbox" checked /> Post Anonymously</label>
        <div style="flex:1"></div>
        <div class="small">Complaint ID will be generated on submit</div>
      </div>

      <div class="actions">
        <button id="submitBtn" class="btn btn-primary">Submit Complaint</button>
        <button id="resetBtn" class="btn btn-ghost">Reset</button>
      </div>

      <div id="formError" class="error" role="alert" aria-live="assertive"></div>
    </div>

    <!-- right: meta + preview -->
    <div class="right-column">
      <div class="panel">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <div class="label">Quick tips</div>
            <div class="small">Clear photos + precise location increase resolution speed.</div>
          </div>
          <div class="info-pill" id="nextId">Next ID: CMP2025-00001</div>
        </div>
        <div style="margin-top:12px" class="label">Preview</div>
        <div class="meta" id="previewMeta">No preview yet. Add title, description and images.</div>

        <div style="margin-top:12px">
          <div class="label">Saved drafts (demo)</div>
          <div id="draftsList" class="small" style="color:var(--muted)">None</div>
        </div>
      </div>

      <div style="height:12px"></div>

      <div class="panel">
        <div class="label">Team / Project</div>
        <div class="small">Civic Connect — Team HUMANTA</div>
        <div style="margin-top:8px" class="small">You can later track your complaint using the tracking link shown after submit.</div>
      </div>
    </div>
  </div>

  <div class="footer">Made by <strong>Team HUMANTA</strong></div>
</div>

<!-- modal -->
<div class="modal-backdrop" id="modal">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <h3 id="modalTitle">Complaint Submitted</h3>
    <p id="modalMsg">Thank you — your complaint has been recorded.</p>
    <div class="ok">
      <a id="trackLink" class="link" href="#" target="_blank">Track complaint</a>
      <button id="closeModal" class="btn btn-primary">Close</button>
    </div>
  </div>
</div>

<script>
(function(){
  // Helpers & element refs
  const imagesInput = document.getElementById('imagesInput');
  const previewList = document.getElementById('previewList');
  const detectBtn = document.getElementById('detectBtn');
  const locStatus = document.getElementById('locStatus');
  const locationInput = document.getElementById('locationInput');
  const authoritySelect = document.getElementById('authoritySelect');
  const aiSuggested = document.getElementById('aiSuggested');
  const applySuggestion = document.getElementById('applySuggestion');
  const titleEl = document.getElementById('title');
  const descEl = document.getElementById('description');
  const submitBtn = document.getElementById('submitBtn');
  const anonToggle = document.getElementById('anonToggle');
  const userName = document.getElementById('userName');
  const userEmail = document.getElementById('userEmail');
  const anonState = document.getElementById('anonState');
  const anonToggleLabel = document.getElementById('anonToggleLabel');
  const nextIdEl = document.getElementById('nextId');
  const previewMeta = document.getElementById('previewMeta');
  const draftsList = document.getElementById('draftsList');
  const modal = document.getElementById('modal');
  const modalMsg = document.getElementById('modalMsg');
  const trackLink = document.getElementById('trackLink');
  const closeModal = document.getElementById('closeModal');
  const formError = document.getElementById('formError');

  // Demo user auto-fill (keeps anonymous option)
  const demoUser = { name: 'Sayan Mallick', email: 'sayan@email.com' };
  userName.value = demoUser.name;
  userEmail.value = demoUser.email;
  updateAnonLabel();

  // Manage images
  let images = []; // {file, url}
  function updatePreviewList(){
    previewList.innerHTML = '';
    images.forEach((it, idx) => {
      const div = document.createElement('div');
      div.className = 'thumb';
      const img = document.createElement('img'); img.src = it.url;
      const btn = document.createElement('button'); btn.innerHTML = '✕'; btn.title='Remove';
      btn.addEventListener('click', ()=>{ images.splice(idx,1); updatePreviewList(); updatePreviewMeta(); });
      div.appendChild(img); div.appendChild(btn);
      previewList.appendChild(div);
    });
  }
  function updatePreviewMeta(){
    let meta = [];
    if(titleEl.value) meta.push(`<strong>Title:</strong> ${escapeHtml(titleEl.value)}`);
    if(descEl.value) meta.push(`<strong>Desc:</strong> ${escapeHtml(descEl.value.substring(0,120))}${descEl.value.length>120?'...':''}`);
    if(images.length) meta.push(`<strong>Images:</strong> ${images.length}`);
    if(locationInput.value) meta.push(`<strong>Location:</strong> ${escapeHtml(locationInput.value)}`);
    previewMeta.innerHTML = meta.length ? meta.join('<br>') : 'No preview yet. Add title, description and images.';
  }

  imagesInput.addEventListener('change', (e)=>{
    const files = Array.from(e.target.files);
    files.forEach(f=>{
      const url = URL.createObjectURL(f);
      images.push({file:f, url});
    });
    updatePreviewList(); updatePreviewMeta();
    imagesInput.value = '';
  });

  // Geo location
  let lastCoords = null;
  detectBtn.addEventListener('click', ()=>{
    if(!navigator.geolocation){ locStatus.textContent = 'Geolocation not supported'; return; }
    locStatus.textContent = 'Locating...';
    navigator.geolocation.getCurrentPosition(pos=>{
      const {latitude, longitude} = pos.coords;
      lastCoords = {latitude, longitude};
      locStatus.textContent = `Detected: ${latitude.toFixed(4)}, ${longitude.toFixed(4)}`;
      // Reverse-geocode placeholder: put coords in locationInput. In real app, call geocoding API
      locationInput.value = `${latitude.toFixed(6)}, ${longitude.toFixed(6)}`;
      updatePreviewMeta();
    }, err=>{
      locStatus.textContent = 'Location denied or error';
    }, {enableHighAccuracy:true, timeout:10000});
  });

  // AI suggestion (simple keyword mapping)
  const authorityMap = [
    {keys:['pothole','road','asphalt','hole'],'authority':'Roads / PWD'},
    {keys:['water','sewage','sewer','leak','pipe'],'authority':'Water / Sewage'},
    {keys:['power','electric','electricity','line','pole'],'authority':'Electricity'},
    {keys:['garbage','waste','sanitation','trash'],'authority':'Sanitation'},
    {keys:['traffic','signal','signals','signage'],'authority':'Traffic Police'},
    {keys:['tree','forest','environment','pollution'],'authority':'Environment / Forests'},
    {keys:['crime','police','theft','robbery'],'authority':'Police'},
  ];
  function suggestAuthority(text){
    const s = (text||'').toLowerCase();
    for(const map of authorityMap){
      for(const k of map.keys){
        if(s.includes(k)) return map.authority;
      }
    }
    return '';
  }

  // update AI suggestion when title/desc change
  function updateAISuggestion(){
    const suggested = suggestAuthority(titleEl.value + ' ' + descEl.value);
    aiSuggested.value = suggested || 'No suggestion found';
  }
  titleEl.addEventListener('input', ()=>{ updateAISuggestion(); updatePreviewMeta(); });
  descEl.addEventListener('input', ()=>{ updateAISuggestion(); updatePreviewMeta(); });

  applySuggestion.addEventListener('click', ()=>{
    const val = aiSuggested.value;
    if(val && val !== 'No suggestion found'){
      authoritySelect.value = val;
    }
  });

  // Anonymous toggle
  anonToggle.addEventListener('change', updateAnonLabel);
  function updateAnonLabel(){
    const isAnon = anonToggle.checked;
    anonState.textContent = isAnon ? 'Anonymous' : 'Show name';
    anonToggleLabel.style.opacity = isAnon ? '0.95':'1';
    // if anonymous, disable name/email fields visually
    userName.disabled = anonToggle.checked;
    userEmail.disabled = anonToggle.checked;
    if(anonToggle.checked){
      userName.style.opacity = '0.6'; userEmail.style.opacity = '0.6';
    } else {
      userName.style.opacity = '1'; userEmail.style.opacity = '1';
    }
    // preview name shown in header
    document.getElementById('demoName').textContent = isAnon ? 'Anonymous' : (userName.value || 'User');
  }
  userName.addEventListener('input', ()=>{ if(!anonToggle.checked) document.getElementById('demoName').textContent = userName.value; });

  // Complaint ID generator using localStorage serial
  const SERIAL_KEY = 'cc_cmp_serial_2025';
  function getNextSerial(){
    let s = parseInt(localStorage.getItem(SERIAL_KEY) || '0', 10);
    s = s + 1;
    localStorage.setItem(SERIAL_KEY, String(s));
    return s;
  }
  function peekNextSerial(){
    let s = parseInt(localStorage.getItem(SERIAL_KEY) || '0', 10);
    s = s + 1;
    return s;
  }
  function formatId(serial){
    const year = new Date().getFullYear();
    return `CMP${year}-${String(serial).padStart(5,'0')}`;
  }
  // show next id
  function refreshNextId(){
    nextIdEl.textContent = `Next ID: ${formatId(peekNextSerial())}`;
  }
  refreshNextId();

  // Save complaint (demo) to localStorage array
  function saveComplaint(data){
    const LIST_KEY = 'cc_complaints_demo';
    const arr = JSON.parse(localStorage.getItem(LIST_KEY) || '[]');
    arr.push(data);
    localStorage.setItem(LIST_KEY, JSON.stringify(arr));
  }

  // Update drafts preview (reads saved drafts)
  function refreshDrafts(){
    const LIST_KEY = 'cc_drafts_demo';
    const arr = JSON.parse(localStorage.getItem(LIST_KEY) || '[]');
    if(arr.length===0) draftsList.textContent = 'None';
    else {
      draftsList.innerHTML = arr.slice(-5).map(d=>`${escapeHtml(d.title||'(no title)')} — ${d.when}`).join('<br>');
    }
  }
  refreshDrafts();

  // submit handler
  submitBtn.addEventListener('click', async ()=>{
    formError.textContent = '';
    const title = titleEl.value.trim();
    const desc = descEl.value.trim();
    const authority = authoritySelect.value;
    const name = userName.value.trim();
    const email = userEmail.value.trim();
    const isAnon = anonToggle.checked;
    const location = locationInput.value.trim() || (lastCoords ? `${lastCoords.latitude},${lastCoords.longitude}` : '');

    if(!title){ formError.textContent = 'Please add a short title for the issue.'; return; }
    if(!desc){ formError.textContent = 'Please describe the issue in detail.'; return; }
    if(!location){ formError.textContent = 'Please detect or enter a location.'; return; }
    // images optional

    // create ID & store
    const serial = getNextSerial();
    const cmpId = formatId(serial);

    // store images as dataURLs (demo) — careful with large files
    const imagesData = await Promise.all(images.map(i => fileToDataURL(i.file)));

    const complaint = {
      id: cmpId,
      title, desc, authoritySelected: authority, aiSuggested: aiSuggested.value,
      name: isAnon ? 'Anonymous' : name || 'Anonymous',
      email: isAnon ? '' : email || '',
      location, coords: lastCoords,
      images: imagesData,
      status: 'Pending',
      createdAt: new Date().toISOString()
    };

    saveComplaint(complaint);
    refreshNextId();

    // show modal with ID and link
    modalMsg.innerHTML = `Your complaint ID is <strong>${cmpId}</strong>. We recommend saving this ID for future tracking.`;
    trackLink.href = `track-complaint.html?id=${encodeURIComponent(cmpId)}`;
    modal.style.display = 'flex';

    // optional: clear form
    // resetForm();
  });

  // helper convert file -> dataURL
  function fileToDataURL(file){
    return new Promise((res, rej)=>{
      const r = new FileReader();
      r.onload = ()=>res(r.result);
      r.onerror = rej;
      r.readAsDataURL(file);
    });
  }

  // Reset button
  document.getElementById('resetBtn').addEventListener('click', resetForm);
  function resetForm(){
    titleEl.value = ''; descEl.value = ''; images = []; updatePreviewList(); updatePreviewMeta();
    locationInput.value = ''; locStatus.textContent = 'No location detected'; authoritySelect.value = '';
    aiSuggested.value = ''; anonToggle.checked = true; updateAnonLabel(); formError.textContent = '';
  }

  // modal close
  closeModal.addEventListener('click', ()=>{ modal.style.display='none'; });

  // simple escape helper for innerHTML
  function escapeHtml(s){ return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

  // update next id on load
  (function init(){
    updateAISuggestion();
    refreshNextId();
    updatePreviewMeta();
  })();

})();
</script>
</body>
</html>
